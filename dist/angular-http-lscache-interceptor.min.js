!function(){var a=window.angular.module("http-lscache-interceptor",["lscacheExtra"]);a.constant("pendingRequests",{}),a.factory("http-lscache-interceptor",["$q","$log","lscacheExtra","pendingRequests",function(a,b,c,d){function e(a){function b(a){if(a)for(var b in a)c+="-"+b+"="+a[b]}var c;return a.lscacheExtra.key?a.lscacheExtra.key:(c=a.url+"-"+a.method,b(a.params),b(a.data),c)}function f(a,b,c,d){return{data:a||{},config:b||{},status:c||200,statusText:d||"OK"}}return{request:function(b){var f,g,h;return b.lscacheExtra&&(f=e(b),g=c.get(f,!0),g?(b.lscacheExtra.cachedData=g,h=a.defer(),h.resolve(),b.timeout=h.promise):f in d?(b.lscacheExtra.pending=!0,h=a.defer(),h.resolve(),b.timeout=h.promise):d[f]=[]),b},response:function(a){var b,f,g=a.config.lscacheExtra;if(g&&(g.ttlUnitMs&&c.setExpiryUnitMs(g.ttlUnitMs),f=e(a.config),b=g.ttl||10,c.set(f,a.data,b),f in d)){for(;d[f].length>0;)d[f].shift().resolve(a);delete d[f]}return a},responseError:function(b){var g,h,i;return b.config&&b.config.lscacheExtra?(i=e(b.config),b.config.lscacheExtra.pending?(delete b.config.lscacheExtra.pending,g=a.defer(),d[i].push(g),g.promise):(h=b.config.lscacheExtra.cachedData,h||(h=c.get(i,!0,!0),h&&(b.config.lscacheExtra.resultWasExpired=!0)),h?(delete b.config.lscacheExtra.cachedData,b.config.lscacheExtra.resultWasCached=!0,g=a.defer(),g.resolve(f(h,b.config)),g.promise):a.reject(b))):b}}}])}();